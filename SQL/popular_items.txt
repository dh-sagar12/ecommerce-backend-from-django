-- FUNCTION: inventory.get_stock_qty_of_product_item(bigint)

-- DROP FUNCTION inventory.get_stock_qty_of_product_item(bigint);

CREATE OR REPLACE FUNCTION product.get_get_popular_product_item()
    RETURNS TABLE(
		product_id bigint, 
		product_inventory_id bigint,
		Product_name character varying,
		sku character varying,
		slug character varying, 
		description character varying, 
		category_name character varying, 
		sub_category_name character varying, 
		brand_name character varying, 
		store_price numeric,
		discount numeric,
		retail_price numeric,
		store_qty numeric
	) 
    LANGUAGE 'plpgsql'

    COST 100
    STABLE 
    ROWS 1000
    
AS $BODY$
 	
BEGIN
    with highest_orders as (
        SELECT product_inventory_id,    SUM(COALESCE(order_qty, 0)) order_qty FROM inventory.orders
        where ordered_date BETWEEN CURRENT_DATE-7 and CURRENT_DATE 
        group by product_inventory_id 
        order by order_qty desc ), 
    inventory_attributes as 

 END
 $BODY$;

ALTER FUNCTION inventory.get_stock_qty_of_product_item(bigint)
    OWNER TO postgres;
	

